# 项目复盘（项目总结报告）

## 个人职责
于7月底加入咱们的大家庭 🏠，入职以来一直是 主要负责电脑端 App 的相关开发。

### 1、授课端开发和优化
electron 方相关的优化和改造，具体且不限于：
* 将项目中的模块化方案 由陈旧的cjs 改为 主流的esm。
* [优化ipc通信策略](https://www.cnblogs.com/dingshaohua/p/18427595)，改造后显著的减少了了此方面代码耦合度，提升了复用性。
* 大量优化代码，将创建窗口、启动服务、菜单管理分 模块化出去，阅读读和后期维护更清晰! 并整理了[最佳electron架构方案](https://fe.dingshaohua.com/electron/architect)。
* 完成了 app 顶部自定义标题栏，使得标题栏可以美观和丰富（的能力），并且让 macos 和 windows表现一致。

初此之外，也负责了授课端web的相关开发，不限制于如下：
* 负责了如下模块的业务开发 <br/><img src="https://img.dingshaohua.com/other/202409251545367.webp" width="600"/>
* 完成了页面根据窗口大小自动适配合适的视觉效果。
* 完成了项目中api模块、和http拦截器（统一异常处理、鉴权处理等）、请求代理等一些基建。

### 2、互动端开发 
完成互动端项目不限于如下：
* 互动端小屏幕的相关问题修复，如永远置顶、窗口透明处理（方案为多窗口 因为electron的透明度、无边框属性不能动态设置）
* 对接 redis+百家云的推送，完成了 egg服务端的开发，后续并配合调研重复上墙问题。

### 3、授课端开发
electron 相关
* 基于之前项目总结的[最佳实践](https://fe.dingshaohua.com/electron/architect) 并继续优化为背景， 完成了 项目的 基建和相关业务开发工作。
* 完成了 项目的 `macos平台的 打包>公证>签名>testflight测试>上传个人与apple store分发`整个流程，并[整理了相关文档](https://fe.dingshaohua.com/electron/mac/pkg-store/pkg)。
* 调研和完成了 平台兼容问题，如window 和 mac 低系统版本和32/64位的兼容， 并[整理了相关文档](https://fe.dingshaohua.com/electron/mac/oldos)。
* 图标问题处理，解决win下图标模糊 和 格式错误不允许上传mac商店问题（mac下为1024和512的icns、win下各分辨率的ico）。

web相关
* 推动小组完成技术迭代，拥抱新的技术，如vue3、vite、yarn、pinia，毕竟vue2早就过时了，且官方放弃维护 vue3也出来很多年了。
* 完成了前端项目的基建，包含初始化项目、api封装、拦截器处理、ui库集成、以及项目团队规范约束插件的集成 如typescript、eslint、prettier、commitlint、husky等，且[整理了最佳架构方案](https://fe.dingshaohua.com/vue/architect)。
* 完成了学生端 【我的直播课】模块的开发，含二级页面和接口联调。
* 完成 对接友盟统计。
* 辅助开发 记住密码和日志存储相关，而且有牵扯到了删除 app清理存储（在electron app提供持久化存储能力，供web使用方案）。


## 遇到的挑战
主要跟开发方面相关，暂无跨部门协作的挑战。

* 在macos签名和公证和发布的过程中，因为没有过这方面的经验（即便有过个人开发electron app for macos，但是也没想过要花钱上传apple store），导致花费了大量时间去做调研和踩坑：
    * 签名卡住，签名需要安装证书，但是证书安装也卡住，安装后证书不生效（如证书链丢失、安装位置不对都会导致），这都需要一次次实验和翻越网上资料，相关资料过时和无效居多。
    * 公证卡住，因为公证是近些年苹果公司才提出的策略，可查资料也并不多，所以也需要花费大量时间去做调研和踩坑。
    * 上传testflight卡住，因在store分发不像个人分发随意，所有有严格要求，如必须添加沙盒权限，但是加了之后很多权限默认都会丢失，还需要补上去，还有标准化的ico，还有传上去提示“缺少出口合规证明”等坑。<br/> <img src="https://img.dingshaohua.com/book-fe/202408301505791.jpg" width="300"/>
    * 发布 apple store 被卡，即便是testflight过了，人工审核也不会过，比如上传的预览过少或没有意义 会拒审，再比如会因确少固定 菜单>窗口>显示 从而不符合apple store 用户体验而被拒等等<br/> <img src="https://img.dingshaohua.com/other/202409251723086.webp" width="600"/>

:::tip 🤫
或许有人会问 mac app上遇到的问题为什么不去请教ios开发人员：第一我已经请教过了，第二ios app和mac app开发流程和上传要求大部分是不能共用的。   

且以上遇到的所有问题，都已经解决，且[整理成册了](https://fe.dingshaohua.com/electron/mac/pkg-store/pkg)。
:::

* mac上开发，涉及到环境变量问题，默认情况下（可视为electron的bug）electron内部提供的环境变量是残缺的，并不包含 `/etc/paths`, 如果用到了，就会踩坑，比如获取当前用户安装了哪些软件，或者使用特定的指令获取当前的设备硬件信息（操作系统版本、cpu型号和架构等）就会失败， 已经解决了 并[整理了文档](https://fe.dingshaohua.com/electron/mac/env)，之所记录 是因为网上相关关键词和方案太少了，花费了一些时间 。

* electron app 缓存与持久存储的冲突问题，为了防止electron 的web有缓存，所有做出了去除渲染进程缓存能力，这也导致了之前依赖于本地存储的网站方案技术均失效，于是又实用了electron提供的持久化存储能力 electron-store，但是又导致了缓存过强的问题，软件删除了 缓存还在，下次安装依然存在，于是边手动设置了合适的app内部位置（app resource），但是又遇到了用户在安装界面就使用app 导致合适app内部无权写入问题，最后给了个弹窗 不允许用户在安装界面 使用。 最终解决，之所以提，是遇到的坑太多了。

* app兼容问题，之所以提 是因为影响到的用户体量太大了，之前也没考虑做兼容，后反馈后 就解决了。


## 经验教训
因为加入时间尚短，暂时没有遇到过多的教训，但是我还是总结了一些：

* 开发过程中，需要经常和产品沟通，有的时候即便产品没提的点， 开发过程中也要及时和产品二次确认，不要积累到用户反馈那一步，就比如兼容性问题！


## 未来计划
继续在技术 的广度和深度上做更多探索，且将个人能力和工作相结合（目前已经这么做了），努力的提高工作效率，及时并优质的完成领导安排的工作内容。